generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AdminUser {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String    @map("password_hash")
  firstName    String    @map("first_name")
  lastName     String    @map("last_name")
  role         String    @default("admin")
  isActive     Boolean   @default(true) @map("is_active")
  lastLogin    DateTime? @map("last_login")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  @@map("admin_users")
}

model Customer {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String?  @map("password_hash")
  firstName    String?  @map("first_name")
  lastName     String?  @map("last_name")
  phone        String?
  address      String?
  city         String?
  country      String?
  isGuest      Boolean  @default(false) @map("is_guest")
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  orders        Order[]
  subscriptions Subscription[]

  @@map("customers")
}

model Product {
  id            String   @id @default(uuid())
  nameEn        String   @map("name_en")
  nameAr        String   @map("name_ar")
  descriptionEn String?  @map("description_en")
  descriptionAr String?  @map("description_ar")
  price         Decimal  @db.Decimal(10, 2)
  originalPrice Decimal? @map("original_price") @db.Decimal(10, 2)
  category      String
  badgeEn       String?  @map("badge_en")
  badgeAr       String?  @map("badge_ar")
  imageUrl      String?  @map("image_url")
  featuresEn    String[] @map("features_en")
  featuresAr    String[] @map("features_ar")
  isFeatured    Boolean  @default(false) @map("is_featured")
  isActive      Boolean  @default(true) @map("is_active")
  stockQuantity Int      @default(0) @map("stock_quantity")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  orderItems OrderItem[]

  @@map("products")
}

model SubscriptionPlan {
  id            String   @id @default(uuid())
  nameEn        String   @map("name_en")
  nameAr        String   @map("name_ar")
  descriptionEn String?  @map("description_en")
  descriptionAr String?  @map("description_ar")
  monthlyPrice  Decimal  @map("monthly_price") @db.Decimal(10, 2)
  annualPrice   Decimal? @map("annual_price") @db.Decimal(10, 2)
  savings       Decimal? @db.Decimal(10, 2)
  mealsPerMonth Int      @map("meals_per_month")
  featuresEn    String[] @map("features_en")
  featuresAr    String[] @map("features_ar")
  isPopular     Boolean  @default(false) @map("is_popular")
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  orderItems    OrderItem[]
  subscriptions Subscription[]

  @@map("subscription_plans")
}

model Order {
  id              String    @id @default(uuid())
  orderNumber     String    @unique @map("order_number")
  customerId      String    @map("customer_id")
  orderType       String    @map("order_type")
  status          String    @default("pending")
  subtotal        Decimal   @db.Decimal(10, 2)
  shippingCost    Decimal   @default(0) @map("shipping_cost") @db.Decimal(10, 2)
  tax             Decimal   @default(0) @db.Decimal(10, 2)
  total           Decimal   @db.Decimal(10, 2)
  shippingAddress Json?     @map("shipping_address")
  dietaryPrefs    String[]  @map("dietary_preferences")
  specialNotes    String?   @map("special_instructions")
  deliveryFreq    String?   @map("delivery_frequency")
  paidAt          DateTime? @map("paid_at")
  shippedAt       DateTime? @map("shipped_at")
  deliveredAt     DateTime? @map("delivered_at")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  customer Customer           @relation(fields: [customerId], references: [id])
  items    OrderItem[]
  tracking DeliveryTracking[]

  @@map("orders")
}

model OrderItem {
  id                 String   @id @default(uuid())
  orderId            String   @map("order_id")
  productId          String?  @map("product_id")
  subscriptionPlanId String?  @map("subscription_plan_id")
  quantity           Int      @default(1)
  unitPrice          Decimal  @map("unit_price") @db.Decimal(10, 2)
  totalPrice         Decimal  @map("total_price") @db.Decimal(10, 2)
  createdAt          DateTime @default(now()) @map("created_at")

  order            Order             @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product          Product?          @relation(fields: [productId], references: [id])
  subscriptionPlan SubscriptionPlan? @relation(fields: [subscriptionPlanId], references: [id])

  @@map("order_items")
}

model Subscription {
  id                 String    @id @default(uuid())
  customerId         String    @map("customer_id")
  planId             String    @map("plan_id")
  status             String    @default("active")
  currentPeriodStart DateTime? @map("current_period_start")
  currentPeriodEnd   DateTime? @map("current_period_end")
  nextDeliveryDate   DateTime? @map("next_delivery_date")
  deliveryFrequency  String?   @map("delivery_frequency")
  dietaryPreferences String[]  @map("dietary_preferences")
  createdAt          DateTime  @default(now()) @map("created_at")
  updatedAt          DateTime  @updatedAt @map("updated_at")

  customer Customer         @relation(fields: [customerId], references: [id])
  plan     SubscriptionPlan @relation(fields: [planId], references: [id])

  @@map("subscriptions")
}

model DeliveryTracking {
  id        String   @id @default(uuid())
  orderId   String   @map("order_id")
  status    String
  location  String?
  notes     String?
  trackedAt DateTime @default(now()) @map("tracked_at")

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("delivery_tracking")
}
